{"ast":null,"code":"import { setLocalStream, callStates, setCallState, setCallingDialog, setCallerUsername, setCallRejected } from \"../../store/actions/call\";\nimport { sendPreOffer, sendPreOfferAnswer } from \"../wssConnection/wssConnection\";\nimport store from \"../../store/store\";\nconst defaultConstrains = {\n  video: true,\n  audio: true\n};\nconst preOfferAnswers = {\n  CALL_ACCEPTED: \"CALL_ACCEPTED\",\n  CALL_REJECTED: \"CALL_REJECTED\",\n  CALL_NOT_AVAILABLE: \"CALL_NOT_AVAILABLE\"\n};\nexport const getLocalStream = () => {\n  navigator.mediaDevices.getUserMedia(defaultConstrains).then(stream => {\n    console.log({\n      stream\n    });\n    store.dispatch(setLocalStream(stream));\n    store.dispatch(setCallState(callStates.CALL_AVAILABLE));\n  }).catch(e => {\n    console.log(\"Error occured when user trie dto get local stream\");\n    console.log(e);\n  });\n};\nlet connectedUserSocketId;\nexport const callToOther = activeUserDetails => {\n  connectedUserSocketId = activeUserDetails.socketId;\n  store.dispatch(setCallState(callStates.CALL_IN_PROGRESS));\n  store.dispatch(setCallingDialog(true));\n  sendPreOffer({\n    callee: activeUserDetails,\n    caller: {\n      username: store.getState().dashReducer.username\n    }\n  });\n};\nexport const handlePreoffer = data => {\n  if (checkIfCallIsPossible()) {\n    connectedUserSocketId = data.callerSocketId;\n    store.dispatch(setCallerUsername(data.callerUsername));\n    store.dispatch(setCallState(callStates.CALL_REQUESTED));\n  } else {\n    sendPreOfferAnswer({\n      callerSocketId: data.callerSocketId,\n      answer: preOfferAnswers.CALL_NOT_AVAILABLE\n    });\n  }\n};\nexport const acceptIncomingCallRequest = () => {\n  sendPreOfferAnswer({\n    callerSocketId: connectedUserSocketId,\n    answer: preOfferAnswers.CALL_ACCEPTED\n  });\n};\nexport const rejectIncomingCallRequest = () => {\n  sendPreOfferAnswer({\n    callerSocketId: connectedUserSocketId,\n    answer: preOfferAnswers.CALL_REJECTED\n  });\n  resetCallData();\n};\nexport const handlePreofferAnswer = data => {\n  // store.dispatch(setCallingDialog(false));\n  if (data.answer === preOfferAnswers.CALL_ACCEPTED) {// Send WebRTC Offer\n  } else {\n    let rejectionReason;\n\n    if (data.answer === preOfferAnswers.CALL_NOT_AVAILABLE) {\n      rejectionReason = \"Callee is not available to pick up the call right now!\";\n    } else {\n      rejectionReason = \"Callee rejected the call\";\n    }\n\n    store.dispatch(setCallRejected({\n      rejection: true,\n      reason: rejectionReason\n    }));\n  }\n}; // If user rejects call\n\nexport const resetCallData = () => {\n  connectedUserSocketId = null;\n  store.dispatch(setCallState(callStates.CALL_UNAVAILABLE));\n}; // Check if call is possible\n\nexport const checkIfCallIsPossible = () => {\n  if (store.getState().call.localStream === null || store.getState().callState !== callStates.CALL_AVAILABLE) {\n    return false;\n  } else {\n    return true;\n  }\n};","map":{"version":3,"sources":["/Users/macuser/Desktop/Sites/React-Projects/VideoTalker/video-talker-app/src/utils/webRTC/webRTCHandler.js"],"names":["setLocalStream","callStates","setCallState","setCallingDialog","setCallerUsername","setCallRejected","sendPreOffer","sendPreOfferAnswer","store","defaultConstrains","video","audio","preOfferAnswers","CALL_ACCEPTED","CALL_REJECTED","CALL_NOT_AVAILABLE","getLocalStream","navigator","mediaDevices","getUserMedia","then","stream","console","log","dispatch","CALL_AVAILABLE","catch","e","connectedUserSocketId","callToOther","activeUserDetails","socketId","CALL_IN_PROGRESS","callee","caller","username","getState","dashReducer","handlePreoffer","data","checkIfCallIsPossible","callerSocketId","callerUsername","CALL_REQUESTED","answer","acceptIncomingCallRequest","rejectIncomingCallRequest","resetCallData","handlePreofferAnswer","rejectionReason","rejection","reason","CALL_UNAVAILABLE","call","localStream","callState"],"mappings":"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","sourcesContent":["import {\n  setLocalStream,\n  callStates,\n  setCallState,\n  setCallingDialog,\n  setCallerUsername,\n  setCallRejected\n} from \"../../store/actions/call\";\nimport {\n    sendPreOffer,\n    sendPreOfferAnswer,\n} from \"../wssConnection/wssConnection\";\nimport store from \"../../store/store\";\n\nconst defaultConstrains = {\n  video: true,\n  audio: true,\n};\n\nconst preOfferAnswers = {\n  CALL_ACCEPTED: \"CALL_ACCEPTED\",\n  CALL_REJECTED: \"CALL_REJECTED\",\n  CALL_NOT_AVAILABLE: \"CALL_NOT_AVAILABLE\",\n};\n\nexport const getLocalStream = () => {\n  navigator.mediaDevices\n    .getUserMedia(defaultConstrains)\n    .then((stream) => {\n      console.log({ stream });\n      store.dispatch(setLocalStream(stream));\n      store.dispatch(setCallState(callStates.CALL_AVAILABLE));\n    })\n    .catch((e) => {\n      console.log(\"Error occured when user trie dto get local stream\");\n      console.log(e);\n    });\n};\n\nlet connectedUserSocketId;\n\nexport const callToOther = (activeUserDetails) => {\n  connectedUserSocketId = activeUserDetails.socketId;\n  store.dispatch(setCallState(callStates.CALL_IN_PROGRESS));\n  store.dispatch(setCallingDialog(true));\n  sendPreOffer({\n    callee: activeUserDetails,\n    caller: {\n      username: store.getState().dashReducer.username,\n    },\n  });\n};\n\nexport const handlePreoffer = (data) => {\n  if (checkIfCallIsPossible()) {\n    connectedUserSocketId = data.callerSocketId;\n    store.dispatch(setCallerUsername(data.callerUsername));\n    store.dispatch(setCallState(callStates.CALL_REQUESTED));\n  } else {\n    sendPreOfferAnswer({\n      callerSocketId: data.callerSocketId,\n      answer: preOfferAnswers.CALL_NOT_AVAILABLE,\n    });\n  }\n};\n\nexport const acceptIncomingCallRequest = () => {\n  sendPreOfferAnswer({\n    callerSocketId: connectedUserSocketId,\n    answer: preOfferAnswers.CALL_ACCEPTED,\n  });\n};\n\nexport const rejectIncomingCallRequest = () => {\n  sendPreOfferAnswer({\n    callerSocketId: connectedUserSocketId,\n    answer: preOfferAnswers.CALL_REJECTED,\n  });\n  resetCallData();\n};\n\nexport const handlePreofferAnswer = (data) => {\n    // store.dispatch(setCallingDialog(false));\n  if (data.answer === preOfferAnswers.CALL_ACCEPTED) {\n    // Send WebRTC Offer\n  } else {\n    let rejectionReason;\n    if (data.answer === preOfferAnswers.CALL_NOT_AVAILABLE) {\n      rejectionReason =\n        \"Callee is not available to pick up the call right now!\";\n    } else {\n      rejectionReason = \"Callee rejected the call\";\n    }\n    store.dispatch(setCallRejected({\n        rejection: true,\n        reason: rejectionReason\n    }));\n  }\n};\n\n// If user rejects call\nexport const resetCallData = () => {\n  connectedUserSocketId = null;\n  store.dispatch(setCallState(callStates.CALL_UNAVAILABLE));\n};\n\n// Check if call is possible\nexport const checkIfCallIsPossible = () => {\n  if (\n    store.getState().call.localStream === null ||\n    store.getState().callState !== callStates.CALL_AVAILABLE\n  ) {\n    return false;\n  } else {\n    return true;\n  }\n};\n"]},"metadata":{},"sourceType":"module"}